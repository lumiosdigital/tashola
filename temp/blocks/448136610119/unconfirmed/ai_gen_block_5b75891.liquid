{% doc %}
  @prompt
    please add a pure text block under header - and make sure any part of it will NEVER be covered by the header, please enable to change the font of text, please also enable to edit the letter spacing of text
    Also can you make it a carousel style that we can input 2-3 messages and it will change every 1-2 seconds
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-text-carousel-{{ ai_gen_id }} {
    width: 100%;
    padding-top: {{ block.settings.top_spacing }}px;
    padding-bottom: {{ block.settings.bottom_spacing }}px;
    padding-left: 20px;
    padding-right: 20px;
    background-color: {{ block.settings.background_color }};
    overflow: hidden;
    position: relative;
  }

  .ai-text-carousel-container-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
    text-align: {{ block.settings.text_alignment }};
  }

  .ai-text-carousel-wrapper-{{ ai_gen_id }} {
    position: relative;
    min-height: 50px;
  }

  .ai-text-carousel-message-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
    font-family: {{ block.settings.text_font.family }}, {{ block.settings.text_font.fallback_families }};
    font-weight: {{ block.settings.text_font.weight }};
    font-style: {{ block.settings.text_font.style }};
    font-size: {{ block.settings.font_size }}px;
    color: {{ block.settings.text_color }};
    letter-spacing: {{ block.settings.letter_spacing }}px;
    line-height: 1.5;
  }

  .ai-text-carousel-message-{{ ai_gen_id }}.active {
    opacity: 1;
    position: relative;
  }

  @media screen and (max-width: 749px) {
    .ai-text-carousel-message-{{ ai_gen_id }} {
      font-size: {{ block.settings.font_size | times: 0.8 }}px;
    }
  }
{% endstyle %}

<text-carousel-{{ ai_gen_id }} class="ai-text-carousel-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-text-carousel-container-{{ ai_gen_id }}">
    <div class="ai-text-carousel-wrapper-{{ ai_gen_id }}">
      {% if block.settings.text_1 != blank %}
        <div class="ai-text-carousel-message-{{ ai_gen_id }} active" data-message="1">
          {{ block.settings.text_1 }}
        </div>
      {% endif %}
      
      {% if block.settings.text_2 != blank %}
        <div class="ai-text-carousel-message-{{ ai_gen_id }}" data-message="2">
          {{ block.settings.text_2 }}
        </div>
      {% endif %}
      
      {% if block.settings.text_3 != blank %}
        <div class="ai-text-carousel-message-{{ ai_gen_id }}" data-message="3">
          {{ block.settings.text_3 }}
        </div>
      {% endif %}
    </div>
  </div>
</text-carousel-{{ ai_gen_id }}>

<script>
  (function() {
    class TextCarousel{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.messages = [];
        this.currentIndex = 0;
        this.intervalId = null;
      }

      connectedCallback() {
        this.messages = Array.from(this.querySelectorAll('.ai-text-carousel-message-{{ ai_gen_id }}'));
        
        if (this.messages.length > 1) {
          const interval = {{ block.settings.rotation_speed }} * 1000;
          this.startRotation(interval);
        }
      }

      startRotation(interval) {
        this.intervalId = setInterval(() => {
          this.messages[this.currentIndex].classList.remove('active');
          
          this.currentIndex = (this.currentIndex + 1) % this.messages.length;
          
          this.messages[this.currentIndex].classList.add('active');
        }, interval);
      }

      disconnectedCallback() {
        if (this.intervalId) {
          clearInterval(this.intervalId);
        }
      }
    }

    customElements.define('text-carousel-{{ ai_gen_id }}', TextCarousel{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Text carousel",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Messages"
    },
    {
      "type": "inline_richtext",
      "id": "text_1",
      "label": "Message 1",
      "default": "Welcome to our store"
    },
    {
      "type": "inline_richtext",
      "id": "text_2",
      "label": "Message 2",
      "default": "Free shipping on orders over Â£50"
    },
    {
      "type": "inline_richtext",
      "id": "text_3",
      "label": "Message 3",
      "default": "New arrivals now available"
    },
    {
      "type": "header",
      "content": "Carousel settings"
    },
    {
      "type": "range",
      "id": "rotation_speed",
      "min": 1,
      "max": 5,
      "step": 1,
      "unit": "s",
      "label": "Rotation speed",
      "default": 2
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "font_picker",
      "id": "text_font",
      "label": "Font",
      "default": "helvetica_n4"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 12,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Font size",
      "default": 16
    },
    {
      "type": "range",
      "id": "letter_spacing",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "unit": "px",
      "label": "Letter spacing",
      "default": 0
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#f5f5f5"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "top_spacing",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top spacing",
      "default": 20
    },
    {
      "type": "range",
      "id": "bottom_spacing",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom spacing",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "Text carousel"
    }
  ]
}
{% endschema %}

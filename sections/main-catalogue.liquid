<div class="breadcrumbs-container">
    {% render 'breadcrumbs' %}
</div>
{% if collection.description != blank %}
<div class="catalogue-header">
    <h1 class="catalogue-title">{{ collection.title }}</h1>
    <div class="catalogue-description">{{ collection.description }}</div>
</div>
{% else %}
<div class="catalogue-header">
    <h1 class="catalogue-title">{{ collection.title }}</h1>
</div>
{% endif %}

<div class="catalogue-container" data-catalogue-container>
    <!-- Filter button (visible on all devices) -->
     <div class="catalogue-controls">
         <div class="mobile-filter-button-wrapper">
             <button class="filter-button" aria-label="Show filters" data-filter-trigger>
                 {% render 'icon-filters' %}
                 <span>Filters</span>
             </button>
         </div>
        <!-- Design Filter Pills -->
        <div class="design-filters">
            <button class="design-filter-button active" data-filter-value="all">All</button>
            <button class="design-filter-button" data-filter-value="hoops">Hoops</button>
            <button class="design-filter-button" data-filter-value="studs">Studs</button>
            <button class="design-filter-button" data-filter-value="dangle">Dangle</button>
            <button class="design-filter-button" data-filter-value="drop">Drop Earrings</button>
            <button class="design-filter-button" data-filter-value="cuffs">Cuffs</button>
        </div>
        <!-- Sort dropdown -->
        <div class="sort-dropdown-wrapper">
            <button class="sort-button" aria-label="Sort products" data-sort-trigger aria-expanded="false"
                aria-controls="sort-dropdown">
                <span>{% if collection.sort_by %}
                    {% case collection.sort_by %}
                    {% when 'price-ascending' %}
                    Sort: Price, low to high
                    {% when 'price-descending' %}
                    Sort: Price, high to low
                    {% when 'best-selling' %}
                    Sort: Best selling
                    {% when 'created-descending' %}
                    Sort: Newest
                    {% else %}
                    Sort By
                    {% endcase %}
                    {% else %}
                    Sort By
                    {% endif %}
                </span>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 9L12 15L18 9" stroke="#373736" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>
            <div class="sort-dropdown" id="sort-dropdown" aria-hidden="true">
                <button class="sort-option {% if collection.sort_by == 'price-ascending' %}active{% endif %}"
                    data-sort-value="price-ascending">Price, low to high</button>
                <button class="sort-option {% if collection.sort_by == 'price-descending' %}active{% endif %}"
                    data-sort-value="price-descending">Price, high to low</button>
                <button class="sort-option {% if collection.sort_by == 'best-selling' %}active{% endif %}"
                    data-sort-value="best-selling">Best selling</button>
                <button class="sort-option {% if collection.sort_by == 'created-descending' %}active{% endif %}"
                    data-sort-value="created-descending">Newest</button>
            </div>  </div>
        </div>
     </div>

    <!-- Main Catalogue Grid and Filters Container -->
    <div class="catalogue-layout">
        <!-- Catalogue Filters - Slide from left -->
        <div class="catalogue-filters-container" data-catalogue-filters aria-hidden="true">
            <div class="catalogue-filters-header">
                <h2>Filters</h2>
                <button class="catalogue-filters-close" aria-label="Close filters" data-filter-close>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <div class="catalogue-filters">
                <form class="catalogue-filters-form" data-filter-form>
                    <!-- Dynamic Material Filter Section -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">Material:</h3>
                        <div class="filter-options">
                            {% comment %} Get all unique material values from product metafields {% endcomment %}
                            {% assign all_materials = '' %}

                            {% for product in collection.products %}
                            {% if product.metafields.shopify.jewelry_material %}
                            {% assign material_value = product.metafields.shopify.jewelry_material %}
                            {% assign all_materials = all_materials | append: ',' | append: material_value %}
                            {% endif %}
                            {% endfor %}

                            {% assign all_materials = all_materials | remove_first: ',' | split: ',' %}
                            {% assign unique_materials = all_materials | uniq | sort %}

                            {% for material in unique_materials %}
                            {% assign material_handle = material | handleize %}
                            <div class="filter-option">
                                <input type="checkbox" id="material-{{ material_handle }}"
                                    name="filter.p.m.metafields.shopify.jewelry_material" value="{{ material }}" {% if current_tags contains
                                    material %}checked{% endif %}>
                                <label for="material-{{ material_handle }}">{{ material }}</label>
                            </div>
                            {% endfor %}

                            {% comment %} Show message if no materials are found {% endcomment %}
                            {% if unique_materials.size == 0 %}
                            <div class="filter-no-options">No materials found</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Color filter -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">Color:</h3>
                        <div class="filter-options">
                            <div class="filter-option">
                                <input type="checkbox" id="color-gold" name="filter.v.option.color" value="Gold">
                                <label for="color-gold">Gold</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="color-silver" name="filter.v.option.color" value="Silver">
                                <label for="color-silver">Silver</label>
                            </div>
                        </div>
                    </div>

                    <!-- Price Range filter -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">Price Range:</h3>
                        <div class="filter-options">
                            <div class="filter-option">
                                <input type="checkbox" id="price-under-20" name="filter.v.price" value="-20">
                                <label for="price-under-20">Under £20</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="price-20-50" name="filter.v.price" value="20:50">
                                <label for="price-20-50">£20 - £50</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="price-50-100" name="filter.v.price" value="50:100">
                                <label for="price-50-100">£50 - £100</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="price-over-100" name="filter.v.price" value="100-">
                                <label for="price-over-100">£100+</label>
                            </div>
                        </div>
                    </div>

                    <!-- Style filter -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">Style:</h3>
                        <div class="filter-options">
                            <div class="filter-option">
                                <input type="checkbox" id="style-minimalist" name="filter.v.option.style"
                                    value="Minimalist">
                                <label for="style-minimalist">Minimalist</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="style-statement" name="filter.v.option.style"
                                    value="Statement">
                                <label for="style-statement">Statement</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="style-classic" name="filter.v.option.style" value="Classic">
                                <label for="style-classic">Classic</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="style-trendy" name="filter.v.option.style" value="Trendy">
                                <label for="style-trendy">Trendy</label>
                            </div>
                        </div>
                    </div>

                    <!-- Collections filter -->
                    <div class="filter-group">
                        <h3 class="filter-group-title">Collections:</h3>
                        <div class="filter-options">
                            <div class="filter-option">
                                <input type="checkbox" id="collection-stellar" name="filter.p.tag"
                                    value="Stellar Collection">
                                <label for="collection-stellar">Stellar Collection</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="collection-neptune" name="filter.p.tag"
                                    value="Neptune Collection">
                                <label for="collection-neptune">Neptune Collection</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="collection-celestial" name="filter.p.tag"
                                    value="Celestial Collection">
                                <label for="collection-celestial">Celestial Collection</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="collection-spartan" name="filter.p.tag"
                                    value="Spartan Collection">
                                <label for="collection-spartan">Spartan Collection</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="collection-deia" name="filter.p.tag" value="Deia Collection">
                                <label for="collection-deia">Deia Collection</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="collection-aurelia" name="filter.p.tag"
                                    value="Aurelia Collection">
                                <label for="collection-aurelia">Aurelia Collection</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="collection-iris" name="filter.p.tag" value="Iris Collection">
                                <label for="collection-iris">Iris Collection</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="collection-charmed" name="filter.p.tag"
                                    value="Charmed Collection">
                                <label for="collection-charmed">Charmed Collection</label>
                            </div>
                        </div>
                    </div>

                    <div class="filter-buttons">
                        <button type="submit" class="btn filter-apply-button">Apply Filters</button>
                        <button type="reset" class="btn filter-clear-button">Clear Filters</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Product Grid -->
        <div class="catalogue-grid-container">
            <div class="catalogue-grid-wrapper">
                <ul class="catalogue-grid" data-catalogue-grid>
                    {% for product in collection.products %}
                    {% assign grid_position = forloop.index %}

                    {% if grid_position == 8 %}
                    <!-- Catalogue Banner 1 - 4th column, 2nd row -->
                    <li class="catalogue-banner banner-1">
                        <a href="{{ section.settings.banner_1_link | default: routes.collections_url }}"
                            class="catalogue-banner-link">
                            <div class="catalogue-banner-image-wrapper">
                                {% if section.settings.banner_1_image %}
                                <img src="{{ section.settings.banner_1_image | img_url: 'master' }}"
                                    alt="{{ section.settings.banner_1_title }}" class="catalogue-banner-image">
                                {% else %}
                                <div class="catalogue-banner-image" style="background-color: #e0e0e0;"></div>
                                {% endif %}
                            </div>
                            <div class="catalogue-banner-content">
                                <h3 class="catalogue-banner-title">
                                    {% if section.settings.banner_1_title contains 'Collection' %}
                                    {% assign title_parts = section.settings.banner_1_title | split: ' Collection' %}
                                    {{ title_parts[0] }} <em>Collection</em>
                                    {% else %}
                                    {{ section.settings.banner_1_title }}
                                    {% endif %}
                                </h3>
                                <p class="catalogue-banner-text">{{ section.settings.banner_1_text }}</p>
                            </div>
                        </a>
                    </li>
                    {% endif %}

                    {% if grid_position == 12 %}
                    <!-- Catalogue Banner 2 - 1st column, 4th row -->
                    <li class="catalogue-banner banner-2">
                        <a href="{{ section.settings.banner_2_link | default: routes.collections_url }}"
                            class="catalogue-banner-link">
                            <div class="catalogue-banner-image-wrapper">
                                {% if section.settings.banner_2_image %}
                                <img src="{{ section.settings.banner_2_image | img_url: 'master' }}"
                                    alt="{{ section.settings.banner_2_title }}" class="catalogue-banner-image">
                                {% else %}
                                <div class="catalogue-banner-image" style="background-color: #e0e0e0;"></div>
                                {% endif %}
                            </div>
                            <div class="catalogue-banner-content">
                                <h3 class="catalogue-banner-title">
                                    {% if section.settings.banner_2_title contains 'Collection' %}
                                    {% assign title_parts = section.settings.banner_2_title | split: ' Collection' %}
                                    {{ title_parts[0] }} <em>Collection</em>
                                    {% else %}
                                    {{ section.settings.banner_2_title }}
                                    {% endif %}
                                </h3>
                                <p class="catalogue-banner-text">{{ section.settings.banner_2_text }}</p>
                            </div>
                        </a>
                    </li>
                    {% endif %}

                        <!-- Updated Product Card with Data Attributes -->
                        <li class="catalogue-product" data-tags="{{ product.tags | join: ',' }}"
                            data-best-selling-rank="{{ product.best_selling_rank | default: 999 }}">
                            <a href="{{ product.url }}" class="product-card-link">
                                <div class="product-card-image-wrapper">
                                    {% if product.featured_image %}
                                        <img src="{{ product.featured_image | img_url: 'master' }}" alt="{{ product.title | escape }}"
                                        class="product-card-image">
                                    {% else %}
                                        <div class="product-card-image-placeholder">{{ product.title | slice: 0, 1 }}</div>
                                    {% endif %}
                                </div>
                                <div class="product-card-content">
                                    <div class="product-title-badge-container">
                                        {% comment %} Product title with a maximum of 2 lines {% endcomment %}
                                        <h3 class="product-card-title">{{ product.title }}</h3>    
                                        {% comment %} Badges container {% endcomment %}
                                        {% if product.tags contains 'New' or product.tags contains 'Best Seller' or product.best_selling_rank <= 5 %} 
                                            <div class="product-badge-container">
                                                {% if product.tags contains 'New' %}
                                                    <span class="product-badge badge-new">New In</span>
                                                {% endif %}
                                                {% if product.tags contains 'Best Seller' or product.best_selling_rank <= 5 %} 
                                                    <span class="product-badge badge-bestseller">Best Seller</span>
                                                {% endif %}
                                            </div>
                                        {% endif %}                                   
                                    </div>

                                    <p class="product-card-price">
                                        {% if product.compare_at_price > product.price %}
                                        <span class="product-card-sale-price">{{ product.price | money }}</span>
                                        <s class="product-card-compare-price">{{ product.compare_at_price | money }}</s>
                                        {% else %}
                                        <span class="product-card-regular-price">{{ product.price | money }}</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Load More Products (for infinite scroll implementation) -->
            <div class="catalogue-load-more" data-load-more>
                {% if paginate.next %}
                <button class="load-more-button" data-load-more-button>Load More</button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="catalogue-filters-backdrop" data-filters-backdrop></div>

{% schema %}
{
"name": "Catalogue",
"settings": [
{
"type": "header",
"content": "Catalogue Layout"
},
{
"type": "range",
"id": "products_per_page",
"label": "Products per page",
"min": 8,
"max": 48,
"step": 4,
"default": 16
},
{
"type": "header",
"content": "Catalogue Banners"
},
{
"type": "image_picker",
"id": "banner_1_image",
"label": "Banner 1 Image"
},
{
"type": "text",
"id": "banner_1_title",
"label": "Banner 1 Title",
"default": "Deia Collection"
},
{
"type": "text",
"id": "banner_1_text",
"label": "Banner 1 Text",
"default": "Classic earrings to embody timeless elegance"
},
{
"type": "url",
"id": "banner_1_link",
"label": "Banner 1 Link"
},
{
"type": "image_picker",
"id": "banner_2_image",
"label": "Banner 2 Image"
},
{
"type": "text",
"id": "banner_2_title",
"label": "Banner 2 Title",
"default": "Stellar Collection"
},
{
"type": "text",
"id": "banner_2_text",
"label": "Banner 2 Text",
"default": "Embrace the celestial beauty"
},
{
"type": "url",
"id": "banner_2_link",
"label": "Banner 2 Link"
}
]
}
{% endschema %}